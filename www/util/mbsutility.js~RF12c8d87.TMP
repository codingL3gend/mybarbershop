var places = 'AIzaSyBRn4K1hSAsfob8cB064EQLpvk4M4l8x1Q';

function validateEmail(email)
{
    if (!(typeof email == "undefined" && email.length > 0 && !(email === ""))) {
        var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;

        return re.test(email);
    }
}

function validateInput(validate)
{
    if (!(typeof validate === "undefined") && validate.length > 0 && !(validate === ""))
        return true;

    return false;
}

function initializeStorage(ready, error)
{
    if (Modernizr.indexeddb) {
        var db = indexedDB.open("mbs");

        db.onupgradeneeded = function () {
            var data = db.result;
            var store = data.createObjectStore("profile", { keyPath: "id" });
            store.createIndex("userid", "id", { unique: true });

            store.put({ id: 4 });
        };

        db.onsuccess = function () {
            data = db.result;
        };
    } else
        if (Modernizr.websqldatabase) {
            return openDatabase('profile', '1.0', 'Profile storage', 5 * 1024 * 1024, function (db) {
                db.changeVersion('', '1.0', function (t) {
                    t.executeSql('CREATE TABLE user (id, userid');
                }, error);
            });
        }
}

function checkUser()
{
    var userid = 0;

    if(Modernizr.indexeddb)
    {
        var request = indexedDB.open("mbs");

        request.onsuccess = function()
        {
            var tx = request.result.transaction("profile", "readonly");
            var store = tx.objectStore("profile");

            store.openCursor().onsuccess = function (event) {
                var cursor = event.target.result;

                if(cursor)
                {
                    userid = cursor.value.id;
                    cursor.continue();
                }
            };

            /*cursor.listen();

            var data = index.get("");

            data.onsuccess = function () {
                var matching = data.result;
                if(matching !== undefined)
                {

                }
            }*/
        }
    }else
        if(Modernizr.websqldatabase)
        {

        }

    return userid;
}

function saveUserData($scope) {
    var userid = 0;

    if (Modernizr.indexeddb) {
        var db = indexedDB.open("mbs");
        
        var data = db.result.transaction("profile", "readwrite");
        var store = data.objectStore("profile");

        store.put({ id: $scope.mbsProfileID });

        return true;
    } else
        if (Modernizr.websqldatabase) {

        }

    return false;
}

function setUserData($scope) {
    localStorage["mbsUsername"] = $scope.mbsUsername;
    localStorage["mbsDisplayName"] = $scope.mbsDisplayName;
    localStorage["mbsID"] = $scope.mbsID;
    localStorage["mbsProfileID"] = $scope.mbsProfileID;
    localStorage["mbsDateCreated"] = $scope.mbsDateCreated;
    localStorage["mbsPrivacy"] = $scope.mbsPrivacy;
    localStorage["mbsProfileStatus"] = $scope.mbsProfileStatus;
    //localStorage["mbsProfileType"] = $scope.mbsProfileType;
    localStorage["mbsAccountType"] = $scope.mbsAccountType;
    localStorage["mbsGalleryID"] = $scope.mbsGalleryID;
    localStorage["mbsGalleryName"] = $scope.mbsGalleryName;
    //localStorage["newUser"] = (($scope.newUser == null) ? false : $scope.newUser);
}

function logOut() {
    clearUserData();
}

function clearUserData() {
    localStorage.clear();

    //window.location = "http://localhost:8080/scout.me.out.spring.angular/login";
}

function getUserData($scope) {
    $scope.mbsUsername = localStorage["mbsUsername"];
    $scope.mbsDisplayName = localStorage["mbsDisplayName"];
    $scope.mbsID = localStorage["mbsID"];
    $scope.mbsProfileID = localStorage["mbsProfileID"];
    $scope.mbsDateCreated = localStorage["mbsDateCreated"];
    $scope.mbsPrivacy = localStorage["mbsPrivacy"];
    $scope.mbsProfileStatus = localStorage["mbsProfileStatus"];
    //$scope.mbsProfileType = localStorage["mbsProfileType"];
    $scope.mbsAccountType = localStorage["mbsAccountType"];
    $scope.mbsGalleryID = localStorage["mbsGalleryID"];
    $scope.mbsGalleryName = localStorage["mbsGalleryName"];
    //$scope.newUser = (localStorage["newUser"] == "true");
}

function renderBarberShops(data)
{
    if(data)
    {
        var container = $("<div/>").addClass("list-group ");

        angular.forEach(data, function (barberShop, key) {
            var shop = $("<div/>").addClass("list-group-item list-group-item-inverse").css("background-color", "black");

            var shopName = $("<label/>").text(barberShop.name);
            var shopAddress = $("<label/>").text(barberShop.vicinity);

            shop.append(shopName)
                .append($("<br/>"))
                .append(shopAddress);

            container.append(shop);
        });

        $("#conDiv").append(container);
    }
}